---
name: api-contract-implementation
description: DTD API Contract Implementation Workflow - Design REST endpoints, TypeScript types, Zod validation, MFA authentication, error handling, rate limiting, and OpenAPI documentation
web_bundle: true
---

# API Contract Implementation Workflow

**Goal:** Implement complete API contract for Dog Trainers Directory including REST endpoints, TypeScript type definitions, Zod validation schemas, MFA authentication, error handling, rate limiting, and OpenAPI documentation.

**Your Role:** In addition to your name, communication_style, and persona, you are also an API architect and TypeScript specialist collaborating with DTD Developer. This is a partnership, not a client-vendor relationship. You bring expertise in API design, RESTful conventions, TypeScript type safety, and API security, while the user brings their domain knowledge of dog trainers directory requirements. Work together as equals.

---

## WORKFLOW ARCHITECTURE

This uses **step-file architecture** for disciplined execution:

### Core Principles

- **Micro-file Design**: Each step is a self contained instruction file that is a part of an overall workflow that must be followed exactly
- **Just-In-Time Loading**: Only current step file is in memory - never load future step files until told to do so
- **Sequential Enforcement**: Sequence within the step files must be completed in order, no skipping or optimization allowed
- **State Tracking**: Document progress in output file frontmatter using `stepsCompleted` array when a workflow produces a document
- **Append-Only Building**: Build documents by appending content as directed to the output file

### Step Processing Rules

1. **READ COMPLETELY**: Always read entire step file before taking any action
2. **FOLLOW SEQUENCE**: Execute all numbered sections in order, never deviate
3. **WAIT FOR INPUT**: If a menu is presented, halt and wait for user selection
4. **CHECK CONTINUATION**: If step has a menu with Continue as an option, only proceed to next step when user selects 'C' (Continue)
5. **SAVE STATE**: Update `stepsCompleted` in frontmatter before loading next step
6. **LOAD NEXT**: When directed, load, read entire file, then execute the next step file

### Critical Rules (NO EXCEPTIONS)

- üõë **NEVER** load multiple step files simultaneously
- üìñ **ALWAYS** read entire step file before execution
- üö´ **NEVER** skip steps or optimize the sequence
- üíæ **ALWAYS** update frontmatter of output files when writing final output for a specific step
- üéØ **ALWAYS** follow exact instructions in step file
- ‚è∏Ô∏è **ALWAYS** halt at menus and wait for user input
- üìã **NEVER** create mental todo lists from future steps

---

## INITIALIZATION SEQUENCE

### 1. Configuration Loading

Load and read full config from {project-root}/_bmad/bmb/config.yaml and resolve:

- `project_name`, `output_folder`, `user_name`, `communication_language`, `document_output_language`, `bmb_creations_output_folder`

### 2. First Step EXECUTION

Load, read full file and then execute `{workflow_path}/steps/step-01-design-endpoints.md` to begin workflow.

---

## WORKFLOW OVERVIEW

### Target Agent
- **Agent**: API Contract Designer (Expert)
- **Agent Path**: `_bmad/agents/expert/api-contract-designer.agent.yaml`

### Workflow Steps (7 Total)

1. **Design REST Endpoints** - Design 25+ RESTful API endpoints
2. **Create TypeScript Type Definitions** - Define TypeScript types for API contracts
3. **Implement Zod Validation Schemas** - Create validation schemas for all endpoints
4. **Configure MFA Authentication** - Implement multi-factor authentication (D-013)
5. **Implement Error Handling** - Create comprehensive error handling strategy
6. **Add Rate Limiting Strategies** - Implement rate limiting for API protection
7. **Generate OpenAPI Documentation** - Generate complete API documentation

### Output Location
- **Workflow File**: `_bmad/workflows/dtd/api-contract-implementation.workflow.yaml`
- **Output Directory**: `DOCS/api/`

### DTD Project Context
- **Technology Stack**: Next.js 15, TypeScript, Tailwind CSS, Supabase, Stripe, Z.AI, z.ai, Vercel
- **Documentation Path**: `DOCS/`
- **User Name**: "DTD Developer"
- **Communication Language**: "English"

---

## WORKFLOW EXECUTION

This workflow will guide you through creating a complete API contract for Dog Trainers Directory. Each step builds upon the previous one, ensuring a robust, type-safe, and secure API foundation.

### Prerequisites
- Database schema implemented (Database Schema Implementation Workflow completed)
- Next.js 15 project structure established
- Supabase client configured
- TypeScript environment set up

### Expected Deliverables
- 25+ RESTful API endpoints designed and documented
- Complete TypeScript type definitions for all API contracts
- Zod validation schemas for all endpoints
- MFA authentication implementation (D-013)
- Comprehensive error handling strategy
- Rate limiting implementation
- OpenAPI/Swagger documentation

---

## STEP FILES

The workflow consists of the following step files located in `steps/` subdirectory:

- `step-01-design-endpoints.md` - Design 25+ REST endpoints
- `step-02-typescript-types.md` - Create TypeScript type definitions
- `step-03-zod-validation.md` - Implement Zod validation schemas
- `step-04-mfa-authentication.md` - Configure MFA authentication (D-013)
- `step-05-error-handling.md` - Implement error handling
- `step-06-rate-limiting.md` - Add rate limiting strategies
- `step-07-openapi-docs.md` - Generate OpenAPI documentation

---

## COMPLETION CRITERIA

Workflow is complete when:
1. All 25+ REST endpoints are designed with proper HTTP methods
2. TypeScript type definitions cover all API contracts
3. Zod validation schemas are implemented for all endpoints
4. MFA authentication is configured and tested (D-013)
5. Error handling covers all edge cases
6. Rate limiting is implemented with appropriate strategies
7. OpenAPI documentation is generated and accessible
8. All endpoints follow RESTful conventions
9. API contract is documented in `DOCS/api/`
10. Integration with database schema is verified
