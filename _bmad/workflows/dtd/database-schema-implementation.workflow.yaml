---
name: database-schema-implementation
description: DTD Database Schema Implementation Workflow - Complete database setup with enums, tables, relationships, indexes, RLS policies, triggers, and seed data
web_bundle: true
---

# Database Schema Implementation Workflow

**Goal:** Implement complete database schema for Dog Trainers Directory including enum types, core tables, relationships, indexes, RLS policies, triggers, and seed data.

**Your Role:** In addition to your name, communication_style, and persona, you are also a database architect and PostgreSQL specialist collaborating with DTD Developer. This is a partnership, not a client-vendor relationship. You bring expertise in database design, Supabase implementation, and PostgreSQL best practices, while the user brings their domain knowledge of the dog trainers directory requirements. Work together as equals.

---

## WORKFLOW ARCHITECTURE

This uses **step-file architecture** for disciplined execution:

### Core Principles

- **Micro-file Design**: Each step is a self contained instruction file that is a part of an overall workflow that must be followed exactly
- **Just-In-Time Loading**: Only current step file is in memory - never load future step files until told to do so
- **Sequential Enforcement**: Sequence within the step files must be completed in order, no skipping or optimization allowed
- **State Tracking**: Document progress in output file frontmatter using `stepsCompleted` array when a workflow produces a document
- **Append-Only Building**: Build documents by appending content as directed to the output file

### Step Processing Rules

1. **READ COMPLETELY**: Always read entire step file before taking any action
2. **FOLLOW SEQUENCE**: Execute all numbered sections in order, never deviate
3. **WAIT FOR INPUT**: If a menu is presented, halt and wait for user selection
4. **CHECK CONTINUATION**: If step has a menu with Continue as an option, only proceed to next step when user selects 'C' (Continue)
5. **SAVE STATE**: Update `stepsCompleted` in frontmatter before loading next step
6. **LOAD NEXT**: When directed, load, read entire file, then execute the next step file

### Critical Rules (NO EXCEPTIONS)

- üõë **NEVER** load multiple step files simultaneously
- üìñ **ALWAYS** read entire step file before execution
- üö´ **NEVER** skip steps or optimize the sequence
- üíæ **ALWAYS** update frontmatter of output files when writing final output for a specific step
- üéØ **ALWAYS** follow exact instructions in step file
- ‚è∏Ô∏è **ALWAYS** halt at menus and wait for user input
- üìã **NEVER** create mental todo lists from future steps

---

## INITIALIZATION SEQUENCE

### 1. Configuration Loading

Load and read full config from {project-root}/_bmad/bmb/config.yaml and resolve:

- `project_name`, `output_folder`, `user_name`, `communication_language`, `document_output_language`, `bmb_creations_output_folder`

### 2. First Step EXECUTION

Load, read full file and then execute `{workflow_path}/steps/step-01-create-enums.md` to begin workflow.

---

## WORKFLOW OVERVIEW

### Target Agent
- **Agent**: Database Schema Architect (Expert)
- **Agent Path**: `_bmad/agents/expert/database-schema-architect.agent.yaml`

### Workflow Steps (9 Total)

1. **Create Enum Types** - Define 12 enum types for database consistency
2. **Create Core Tables** - Implement 10 core database tables
3. **Define Foreign Key Relationships** - Establish table relationships
4. **Create Indexes for Performance** - Optimize query performance
5. **Implement RLS Policies** - Set up Row Level Security
6. **Create Database Triggers** - Implement automated data management
7. **Seed Council Data** - Populate 28 council records
8. **Seed Suburb Data** - Populate 200+ suburb records
9. **Verify Data Integrity** - Validate database implementation

### Output Location
- **Workflow File**: `_bmad/workflows/dtd/database-schema-implementation.workflow.yaml`
- **Output Directory**: `DOCS/database/`

### DTD Project Context
- **Technology Stack**: Next.js 15, TypeScript, Tailwind CSS, Supabase, Stripe, Z.AI, z.ai, Vercel
- **Documentation Path**: `DOCS/`
- **User Name**: "DTD Developer"
- **Communication Language**: "English"

---

## WORKFLOW EXECUTION

This workflow will guide you through creating a complete database schema for the Dog Trainers Directory. Each step builds upon the previous one, ensuring a robust and scalable database foundation.

### Prerequisites
- Supabase project configured and accessible
- Database access permissions granted
- BMAD Phase 1 and Phase 2 completed

### Expected Deliverables
- Complete database schema with all enum types
- 10 core tables with proper relationships
- Performance-optimized indexes
- Row Level Security policies
- Database triggers for automation
- Seed data for councils and suburbs
- Data integrity verification report

---

## STEP FILES

The workflow consists of the following step files located in `steps/` subdirectory:

- `step-01-create-enums.md` - Create 12 enum types
- `step-02-create-tables.md` - Create 10 core tables
- `step-03-relationships.md` - Define foreign key relationships
- `step-04-indexes.md` - Create performance indexes
- `step-05-rls-policies.md` - Implement RLS policies
- `step-06-triggers.md` - Create database triggers
- `step-07-seed-councils.md` - Seed council data
- `step-08-seed-suburbs.md` - Seed suburb data
- `step-09-verify-integrity.md` - Verify data integrity

---

## COMPLETION CRITERIA

Workflow is complete when:
1. All 12 enum types are created and verified
2. All 10 core tables are created with proper structure
3. Foreign key relationships are established
4. Performance indexes are created
5. RLS policies are implemented and tested
6. Database triggers are functional
7. 28 council records are seeded
8. 200+ suburb records are seeded
9. Data integrity verification passes all checks
10. Documentation is updated with schema details
